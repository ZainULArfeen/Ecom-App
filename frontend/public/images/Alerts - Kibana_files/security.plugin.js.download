/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */!function(e){function t(t){for(var n,s,r=t[0],a=t[1],o=0,u=[];o<r.length;o++)s=r[o],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&u.push(i[s][0]),i[s]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(c&&c(t);u.length;)u.shift()()}var n={},i={3:0};function s(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise((function(t,s){n=i[e]=[t,s]}));t.push(n[2]=r);var a,o=document.createElement("script");o.charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.src=function(e){return s.p+"security.chunk."+e+".js"}(e);var c=new Error;a=function(t){o.onerror=o.onload=null,clearTimeout(u);var n=i[e];if(0!==n){if(n){var s=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+s+": "+r+")",c.name="ChunkLoadError",c.type=s,c.request=r,n[1](c)}i[e]=void 0}};var u=setTimeout((function(){a({type:"timeout",target:o})}),12e4);o.onerror=o.onload=a,document.head.appendChild(o)}return Promise.all(t)},s.m=e,s.c=n,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s.oe=function(e){throw console.error(e),e};var r=window.security_bundle_jsonpfunction=window.security_bundle_jsonpfunction||[],a=r.push.bind(r);r.push=t,r=r.slice();for(var o=0;o<r.length;o++)t(r[o]);var c=a;s(s.s=36)}([function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t,n){e.exports=n(18)(2)},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t){e.exports=__kbnSharedDeps__.ReactRouterDom},function(e,t){e.exports=__kbnSharedDeps__.KbnI18nReact},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return l}));var i=n(3),s=n(7),r=n(0);const a=Object(i.createContext)(void 0),o=({children:e,...t})=>{const n=Object(i.useContext)(a),s=Object(r.jsx)(u,{breadcrumb:t},e);return n?s:Object(r.jsx)(c,null,s)},c=({children:e,onChange:t})=>{const{services:n}=Object(s.useKibana)(),o=Object(i.useRef)([]),c=e=>{const i=e.map(((t,n)=>n===e.length-1?{...t,href:void 0}:t));t?t(i):n.chrome&&l(n.chrome)(i)};return Object(r.jsx)(a.Provider,{value:{parents:[],onMount:e=>{e.length>o.current.length&&(o.current=e,c(e))},onUnmount:e=>{e.length<o.current.length&&(o.current=e,c(e))}}},e)},u=({breadcrumb:e,children:t})=>{const{parents:n,onMount:s,onUnmount:o}=Object(i.useContext)(a),c=[...n,e];return Object(i.useEffect)((()=>(s(c),()=>o(n))),[e.text,e.href]),Object(r.jsx)(a.Provider,{value:{parents:c,onMount:s,onUnmount:o}},t)};function l(e,t=e.setBreadcrumbs){return n=>{t(n),0===n.length?e.docTitle.reset():e.docTitle.change(function(e,t=2){return e.slice(0,t).reverse().map((({text:e})=>e))}(n))}}},function(e,t){e.exports=__kbnSharedDeps__.ReactDom},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return o})),n.d(t,"h",(function(){return c})),n.d(t,"g",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"l",(function(){return h})),n.d(t,"j",(function(){return d})),n.d(t,"i",(function(){return p})),n.d(t,"k",(function(){return b})),n.d(t,"m",(function(){return f}));const i="*",s="auth_provider_hint",r="auth_url_hash",a="provider",o="msg",c="next",u=/^(?! )[a-zA-Z0-9 !"#$%&'()*+,\-./\\:;<=>?@\[\]^_`{|}~]*[a-zA-Z0-9!"#$%&'()*+,\-./\\:;<=>?@\[\]^_`{|}~]$/,l=1024,h=5e3,d=3e5,p=1e3,b=6e4,f="/internal/security/session"},function(e,t){e.exports=__kbnSharedDeps__.RxjsOperators},function(e,t,n){e.exports=n(18)(3)},function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return o.a})),n.d(t,"e",(function(){return o.c})),n.d(t,"c",(function(){return o.b}));var i=n(26),s=n.n(i);const[r,a]=s()((({userProfiles:e,users:t})=>({userProfiles:e,users:t})));var o=n(15)},function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return p}));var i=n(26),s=n.n(i),r=n(32),a=n.n(r),o=n(17),c=n.n(o),u=n(14);const[l,h]=s()((({authc:e})=>e));function d(){const e=h();return a()(e.getCurrentUser,[e])}function p(e){const{userProfiles:t}=Object(u.d)(),n=c()(t.dataUpdates$);return a()((()=>t.getCurrent(e?{dataPath:e}:void 0)),[t,n])}},function(e,t,n){e.exports=n(18)(6)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),s=n(3),r=i.__importDefault(n(39));t.default=function(e,t){var n=s.useState(t),i=n[0],a=n[1];return r.default((function(){var t=e.subscribe(a);return function(){return t.unsubscribe()}}),[e]),i}},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i=e=>{try{return decodeURIComponent(e)}catch{return e}}},function(e,t,n){"use strict";n.d(t,"f",(function(){return r})),n.d(t,"g",(function(){return a})),n.d(t,"h",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return h})),n.d(t,"o",(function(){return c})),n.d(t,"c",(function(){return u})),n.d(t,"d",(function(){return x})),n.d(t,"j",(function(){return g})),n.d(t,"l",(function(){return j})),n.d(t,"m",(function(){return f})),n.d(t,"n",(function(){return v})),n.d(t,"i",(function(){return m})),n.d(t,"k",(function(){return b})),n.d(t,"p",(function(){return S})),n.d(t,"e",(function(){return y}));var i=n(2);function s(e){return e.full_name||e.email||e.username}function r(e,t){if(t&&t.color)return t.color;const n=s(e).codePointAt(0)||97;return i.VISUALIZATION_COLORS[n%i.VISUALIZATION_COLORS.length]}function a(e,t){if(t&&t.initials)return t.initials;const n=s(e).split(" "),i=Math.min(2,n.length);return n.splice(i,n.length),n.map((e=>e.substring(0,1))).join("")}const o=["reserved","native"];function c(e){return"anonymous"===e.authentication_provider.type}function u(e){return!c(e)&&"http"!==e.authentication_provider.type}function l(e){return o.includes(e.authentication_realm.type)&&!c(e)}function h(e,t){return"native"===e.authentication_realm.type&&t.management.security.users}var d=n(24),p=n(4);function b(e){var t,n;return null===(t=null===(n=e.transient_metadata)||void 0===n?void 0:n.enabled)||void 0===t||t}function f(e){var t,n;return null!==(t=null===(n=e.metadata)||void 0===n?void 0:n._reserved)&&void 0!==t&&t}function g(e){var t,n;return null!==(t=null===(n=e.metadata)||void 0===n?void 0:n._deprecated)&&void 0!==t&&t}function v(e){var t,n;return null!==(t=f(e)&&(null===(n=e.name)||void 0===n?void 0:n.endsWith("_system")))&&void 0!==t&&t}function m(e){var t,n;return null!==(t=f(e)&&((null===(n=e.name)||void 0===n?void 0:n.endsWith("_admin"))||"superuser"===e.name))&&void 0!==t&&t}function y(e){return p.i18n.translate("xpack.security.common.extendedRoleDeprecationNotice",{defaultMessage:"The {roleName} role is deprecated. {reason}",values:{roleName:e.name,reason:_(e)}})}function j(e){var t,n;return f(e)||(null!==(t=null===(n=e._transform_error)||void 0===n?void 0:n.length)&&void 0!==t?t:0)>0}function x(e){return Object(d.cloneDeep)(e)}function S(e){const t=x(e);return t.name="",t}function _(e){var t,n;return null!==(t=null===(n=e.metadata)||void 0===n?void 0:n._deprecated_reason)&&void 0!==t?t:""}},function(e,t,n){"use strict";n.r(t),n.d(t,"UserAPIClient",(function(){return i.UserAPIClient})),n.d(t,"usersManagementApp",(function(){return p}));var i=n(25),s=(n(3),n(9)),r=n(5),a=n(4),o=n(6),c=n(7),u=n(8),l=n(15),h=n(19),d=n(0);const p=Object.freeze({id:"users",create({authc:e,getStartServices:t}){const i=a.i18n.translate("xpack.security.management.usersTitle",{defaultMessage:"Users"});return{id:this.id,order:10,title:i,async mount({element:i,theme$:o,setBreadcrumbs:c,history:l}){const[[p],{UsersGridPage:f},{CreateUserPage:g,EditUserPage:v},{UserAPIClient:m},{RolesAPIClient:y}]=await Promise.all([t(),n.e(12).then(n.bind(null,291)),n.e(9).then(n.bind(null,289)),Promise.resolve().then(n.bind(null,25)),Promise.resolve().then(n.bind(null,31))]);return Object(s.render)(Object(d.jsx)(b,{services:p,theme$:o,history:l,authc:e,onChange:Object(u.c)(p.chrome,c)},Object(d.jsx)(u.a,{text:a.i18n.translate("xpack.security.users.breadcrumb",{defaultMessage:"Users"}),href:"/"},Object(d.jsx)(r.Switch,null,Object(d.jsx)(r.Route,{path:["/",""],exact:!0},Object(d.jsx)(f,{notifications:p.notifications,userAPIClient:new m(p.http),rolesAPIClient:new y(p.http),history:l,navigateToApp:p.application.navigateToApp})),Object(d.jsx)(r.Route,{path:"/create"},Object(d.jsx)(u.a,{text:a.i18n.translate("xpack.security.users.editUserPage.createBreadcrumb",{defaultMessage:"Create"}),href:"/create"},Object(d.jsx)(g,null))),Object(d.jsx)(r.Route,{path:"/edit/:username",render:e=>{const t=Object(h.a)(e.match.params.username);return Object(d.jsx)(u.a,{text:t,href:`/edit/${encodeURIComponent(t)}`},Object(d.jsx)(v,{username:t}))}}),Object(d.jsx)(r.Route,{path:"/edit"},Object(d.jsx)(r.Redirect,{to:"/create"}))))),i),()=>{Object(s.unmountComponentAtNode)(i)}}}}}),b=({services:e,theme$:t,history:n,authc:i,onChange:s,children:a})=>Object(d.jsx)(c.KibanaContextProvider,{services:e},Object(d.jsx)(l.a,{authc:i},Object(d.jsx)(o.I18nProvider,null,Object(d.jsx)(c.KibanaThemeProvider,{theme$:t},Object(d.jsx)(r.Router,{history:n},Object(d.jsx)(u.b,{onChange:s},a))))))},function(e,t,n){e.exports=n(18)(2684)},function(e,t,n){e.exports=n(18)(24)},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t,n){"use strict";n.r(t),n.d(t,"UserAPIClient",(function(){return UserAPIClient}));const i="/internal/security/users";class UserAPIClient{constructor(e){this.http=e}async getUsers(){return await this.http.get(i)}async getUser(e){return await this.http.get(`${i}/${encodeURIComponent(e)}`)}async deleteUser(e){await this.http.delete(`${i}/${encodeURIComponent(e)}`)}async saveUser(e){await this.http.post(`${i}/${encodeURIComponent(e.username)}`,{body:JSON.stringify(e)})}async changePassword(e,t,n){const s={newPassword:t};n&&(s.password=n),await this.http.post(`${i}/${encodeURIComponent(e)}/password`,{body:JSON.stringify(s)})}async disableUser(e){await this.http.post(`${i}/${encodeURIComponent(e)}/_disable`)}async enableUser(e){await this.http.post(`${i}/${encodeURIComponent(e)}/_enable`)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3);function s(e,t){if(null==e)return{};var n,i,s={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(s[n]=e[n]);return s}var r={};function a(e){return function(){return i.useContext(e)}}t.default=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var c=[],u=[],l=function(e){var t=i.createContext(r);c.push(t),u.push(a(t))};n.length?n.forEach((function(e){return l(e.name)})):l(e.name);var h=function(t){for(var r=t.children,a=s(t,["children"]),o=e(a),u=r,l=0;l<c.length;l+=1){var h=c[l],d=n[l]||function(e){return e};u=i.createElement(h.Provider,{value:d(o)},u)}return u};return[h].concat(u)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),s=n(3),r=i.__importDefault(n(38));t.default=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={loading:!1});var a=s.useRef(0),o=r.default(),c=s.useState(n),u=c[0],l=c[1],h=s.useCallback((function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var s=++a.current;return l((function(e){return i.__assign(i.__assign({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return o()&&s===a.current&&l({value:e,loading:!1}),e}),(function(e){return o()&&s===a.current&&l({error:e,loading:!1}),e}))}),t);return[u,h]}},function(e,t){e.exports=__kbnSharedDeps__.TsLib},function(e,t,n){e.exports=n(18)(10)},function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n(12),s=n.n(i),r=n(16),a=n.n(r),o=n(2);function c(e,t){if(t&&t.color)return t.color;var n=l(e).codePointAt(0)||97;return o.VISUALIZATION_COLORS[n%o.VISUALIZATION_COLORS.length]}function u(e,t){if(t&&t.initials)return t.initials;var n=l(e).split(" "),i=Math.min(2,n.length);return n.splice(i,n.length),n.map((function(e){return e.substring(0,1)})).join("")}function l(e){return e.full_name||e.email||e.username}n(3);var h=n(0),d=["user","avatar"],p=function(e){var t=e.user,n=e.avatar,i=a()(e,d),r=Object(o.useEuiTheme)().euiTheme;if(!t)return Object(h.jsx)(o.EuiAvatar,s()({name:"",color:r.colors.lightestShade,initials:"?"},i));var p=l(t);return null!=n&&n.imageUrl?Object(h.jsx)(o.EuiAvatar,s()({name:p,imageUrl:n.imageUrl,color:"plain"},i)):Object(h.jsx)(o.EuiAvatar,s()({name:p,initials:u(t,n),initialsLength:2,color:c(t,n)},i))};n(22),n(23),n(29),n(4),n(6)},function(e,t,n){"use strict";n.r(t),n.d(t,"rolesManagementApp",(function(){return l})),n.d(t,"RolesAPIClient",(function(){return h.RolesAPIClient})),n(3);var i=n(9),s=n(5),r=n(4),a=n(7),o=n(8),c=n(19),u=n(0);const l=Object.freeze({id:"roles",create({license:e,fatalErrors:t,getStartServices:l}){const h=r.i18n.translate("xpack.security.management.rolesTitle",{defaultMessage:"Roles"});return{id:this.id,order:20,title:h,async mount({element:d,theme$:p,setBreadcrumbs:b,history:f}){const[[g,{dataViews:v,features:m,spaces:y}],{RolesGridPage:j},{EditRolePage:x},{RolesAPIClient:S},{IndicesAPIClient:_},{PrivilegesAPIClient:O},{UserAPIClient:w}]=await Promise.all([l(),n.e(13).then(n.bind(null,290)),n.e(5).then(n.bind(null,283)),Promise.resolve().then(n.bind(null,33)),n.e(19).then(n.bind(null,279)),n.e(20).then(n.bind(null,280)),Promise.resolve().then(n.bind(null,21))]),{application:A,docLinks:P,http:C,i18n:k,notifications:I,chrome:E}=g;E.docTitle.change(h);const T=new S(C),M=({action:n})=>{const{roleName:i}=Object(s.useParams)(),a=i?Object(c.a)(i):void 0,l="edit"===n&&i&&a?{text:a,href:`/edit/${encodeURIComponent(i)}`}:{text:r.i18n.translate("xpack.security.roles.createBreadcrumb",{defaultMessage:"Create"})},h=null==y?void 0:y.ui;return Object(u.jsx)(o.a,{text:l.text,href:l.href},Object(u.jsx)(x,{action:n,roleName:a,rolesAPIClient:T,userAPIClient:new w(C),indicesAPIClient:new _(C),privilegesAPIClient:new O(C),getFeatures:m.getFeatures,http:C,notifications:I,fatalErrors:t,license:e,docLinks:P,uiCapabilities:A.capabilities,dataViews:v,history:f,spacesApiUi:h}))};return Object(i.render)(Object(u.jsx)(a.KibanaContextProvider,{services:g},Object(u.jsx)(k.Context,null,Object(u.jsx)(a.KibanaThemeProvider,{theme$:p},Object(u.jsx)(s.Router,{history:f},Object(u.jsx)(o.b,{onChange:Object(o.c)(E,b)},Object(u.jsx)(o.a,{text:h,href:"/"},Object(u.jsx)(s.Route,{path:["/",""],exact:!0},Object(u.jsx)(j,{notifications:I,rolesAPIClient:T,history:f})),Object(u.jsx)(s.Route,{path:"/edit/:roleName?"},Object(u.jsx)(M,{action:"edit"})),Object(u.jsx)(s.Route,{path:"/clone/:roleName"},Object(u.jsx)(M,{action:"clone"})))))))),d),()=>{Object(i.unmountComponentAtNode)(d)}}}}});var h=n(33)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),s=n(3),r=i.__importDefault(n(27));t.default=function(e,t){void 0===t&&(t=[]);var n=r.default(e,t,{loading:!0}),i=n[0],a=n[1];return s.useEffect((function(){a()}),[a]),i}},function(e,t,n){"use strict";n.r(t),n.d(t,"RolesAPIClient",(function(){return RolesAPIClient}));var i=n(20);class RolesAPIClient{constructor(e){this.http=e}async getRoles(){return await this.http.get("/api/security/role")}async getRole(e){return await this.http.get(`/api/security/role/${encodeURIComponent(e)}`)}async deleteRole(e){await this.http.delete(`/api/security/role/${encodeURIComponent(e)}`)}async saveRole({role:e,createOnly:t=!1}){await this.http.put(`/api/security/role/${encodeURIComponent(e.name)}`,{body:JSON.stringify(this.transformRoleForSave(Object(i.d)(e))),query:{createOnly:t}})}transformRoleForSave(e){return e.elasticsearch.indices=e.elasticsearch.indices.filter((e=>!(e=>0===e.names.length)(e))),e.elasticsearch.indices.forEach((e=>e.query||delete e.query)),e.kibana.forEach((e=>{e.base.length>0&&(e.feature={})})),delete e.name,delete e.transient_metadata,delete e._unrecognized_applications,delete e._transform_error,e}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return v})),n.d(t,"a",(function(){return y})),n.d(t,"c",(function(){return f})),n.d(t,"d",(function(){return b}));var i=n(12),s=n.n(i),r=n(3),a=n.n(r),o=n(16),c=n.n(o),u=n(17),l=n.n(u),h=n(0),d=["children"],p=a.a.createContext(null),b=function(e){var t=e.children,n=c()(e,d),i=n.navigateToUrl,s=n.currentAppId;return Object(h.jsx)(p.Provider,{value:{navigateToUrl:i,currentAppId:s}},t)},f=function(e){var t=e.children,n=e.coreStart.application,i=n.navigateToUrl,s=n.currentAppId$,r=l()(s,void 0);return Object(h.jsx)(p.Provider,{value:{navigateToUrl:i,currentAppId:r}},t)};n(2);var g=function(e){var t=e.children,n=e.navigateToUrl,i=e.currentAppId,s=e.className,a=Object(r.useRef)(null),o=Object(r.useCallback)((function(e){return function(e){var t=e.event,n=e.container,i=e.navigateToUrl,s=e.currentAppId;if(n&&s){var r=function(e,t){var n=e;do{var i,s;if("a"===(null===(i=n)||void 0===i?void 0:i.tagName.toLowerCase()))return n;var r=null===(s=n)||void 0===s?void 0:s.parentElement;if(!r||r===document.body||r===t)break;n=r}while(parent||parent!==document.body||parent!==t)}(t.target,n);if(r){var a=r.href,o=""===r.target||"_self"===r.target,c=0===t.button;a&&o&&c&&!t.defaultPrevented&&!function(e){return e.metaKey||e.altKey||e.ctrlKey||e.shiftKey}(t)&&(t.preventDefault(),i(r.href))}}}({event:e,currentAppId:i,navigateToUrl:n,container:a.current})}),[i,n]);return Object(h.jsx)("div",{ref:a,onClick:o,className:s},t)},v=function(e){var t=e.className,n=e.children;return Object(h.jsx)(g,s()({},function(){var e=Object(r.useContext)(p);if(!e)throw new Error("RedirectAppLinksContext is missing.  Ensure your component or React root is wrapped with RedirectAppLinksProvider.");return e}(),{className:t}),n)},m=["children","className"],y=function(e){var t=e.children,n=e.className,i=c()(e,m),s=Object(h.jsx)(v,{className:n},t);if(void 0!==i.coreStart){var r=i.coreStart;return Object(h.jsx)(f,{coreStart:r},s)}var a=i.navigateToUrl,o=i.currentAppId;return Object(h.jsx)(b,{currentAppId:o,navigateToUrl:a},s)}},function(e,t,n){n.r(t);var i=__kbnBundles__.get("entry/core/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t,n){n(37),__kbnBundles__.define("plugin/security/public",n,40)},function(e,t,n){n.p=window.__kbnPublicPath__.security},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3);t.default=function(){var e=i.useRef(!1),t=i.useCallback((function(){return e.current}),[]);return i.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s="undefined"!=typeof window?i.useLayoutEffect:i.useEffect;t.default=s},function(e,t,n){"use strict";n.r(t),n.d(t,"plugin",(function(){return oe}));var i=n(1),s=n.n(i),r=n(4),a=n(11);class license_service_SecurityLicenseService{constructor(){s()(this,"licenseSubscription",void 0)}setup({license$:e}){let t;return this.licenseSubscription=e.subscribe((e=>{t=e})),{license:Object.freeze({isLicenseAvailable:()=>{var e,n;return null!==(e=null===(n=t)||void 0===n?void 0:n.isAvailable)&&void 0!==e&&e},isEnabled:()=>this.isSecurityEnabledFromRawLicense(t),hasAtLeast:e=>{var n;return null===(n=t)||void 0===n?void 0:n.hasAtLeast(e)},getFeatures:()=>this.calculateFeaturesFromRawLicense(t),features$:e.pipe(Object(a.map)((e=>this.calculateFeaturesFromRawLicense(e))))})}}stop(){this.licenseSubscription&&(this.licenseSubscription.unsubscribe(),this.licenseSubscription=void 0)}isSecurityEnabledFromRawLicense(e){if(!e)return!1;const t=e.getFeature("security");return void 0!==t&&t.isAvailable&&t.isEnabled}calculateFeaturesFromRawLicense(e){if(null==e||!e.isAvailable)return{showLogin:!0,allowLogin:!1,showLinks:!1,showRoleMappingsManagement:!1,allowAccessAgreement:!1,allowAuditLogging:!1,allowRoleDocumentLevelSecurity:!1,allowRoleFieldLevelSecurity:!1,allowRbac:!1,allowSubFeaturePrivileges:!1,allowUserProfileCollaboration:!1,layout:void 0===e||null!=e&&e.isAvailable?"error-es-unavailable":"error-xpack-unavailable"};if(!this.isSecurityEnabledFromRawLicense(e))return{showLogin:!1,allowLogin:!1,showLinks:!1,showRoleMappingsManagement:!1,allowAccessAgreement:!1,allowAuditLogging:!1,allowRoleDocumentLevelSecurity:!1,allowRoleFieldLevelSecurity:!1,allowRbac:!1,allowSubFeaturePrivileges:!1,allowUserProfileCollaboration:!1};const t=e.hasAtLeast("standard"),n=e.hasAtLeast("gold"),i=e.hasAtLeast("platinum");return{showLogin:!0,allowLogin:!0,showLinks:!0,showRoleMappingsManagement:n,allowAccessAgreement:n,allowAuditLogging:n,allowSubFeaturePrivileges:n,allowRoleDocumentLevelSecurity:i,allowRoleFieldLevelSecurity:i,allowRbac:!0,allowUserProfileCollaboration:t}}}var o=n(3),c=n.n(o),u=n(9),l=n.n(u),h=n(5),d=n(35),p=n(6),b=n(7),f=n(14),g=n(8),v=n(0);const m=Object.freeze({id:"security_account",create({application:e,authc:t,getStartServices:i,securityApiClients:s}){e.register({id:this.id,title:r.i18n.translate("xpack.security.account.breadcrumb",{defaultMessage:"User settings"}),navLinkStatus:d.AppNavLinkStatus.hidden,appRoute:"/security/account",async mount({element:e,theme$:r,history:a}){const[[o],{AccountManagementPage:c}]=await Promise.all([i(),n.e(6).then(n.bind(null,286))]);return Object(u.render)(Object(v.jsx)(y,{services:o,theme$:r,history:a,authc:t,securityApiClients:s},Object(v.jsx)(c,null)),e),()=>Object(u.unmountComponentAtNode)(e)}})}}),y=({services:e,theme$:t,history:n,authc:i,securityApiClients:s,onChange:r,children:a})=>Object(v.jsx)(b.KibanaContextProvider,{services:e},Object(v.jsx)(f.a,{authc:i},Object(v.jsx)(f.b,s,Object(v.jsx)(p.I18nProvider,null,Object(v.jsx)(b.KibanaThemeProvider,{theme$:t},Object(v.jsx)(h.Router,{history:n},Object(v.jsx)(g.b,{onChange:r},a)))))));var j=n(13);class user_profile_api_client_UserProfileAPIClient{constructor(e){s()(this,"internalDataUpdates$",new j.Subject),s()(this,"dataUpdates$",this.internalDataUpdates$.asObservable()),this.http=e}getCurrent(e){return this.http.get("/internal/security/user_profile",{query:{dataPath:null==e?void 0:e.dataPath}})}bulkGet(e){return this.http.post("/internal/security/user_profile/_bulk_get",{body:JSON.stringify({...e,uids:[...e.uids]})})}suggest(e,t){return this.http.post(e,{body:JSON.stringify(t)})}update(e){return this.http.post("/internal/security/user_profile/_data",{body:JSON.stringify(e)}).then((()=>{this.internalDataUpdates$.next(e)}))}}class analytics_service_AnalyticsService{constructor(){s()(this,"securityLicense",void 0),s()(this,"securityFeaturesSubscription",void 0)}setup({securityLicense:e}){this.securityLicense=e}start({http:e}){this.securityFeaturesSubscription=this.securityLicense.features$.pipe(Object(j.filter)((({allowLogin:e})=>e)),Object(a.throttleTime)(5e3)).subscribe((async()=>{try{await analytics_service_AnalyticsService.recordAuthTypeAnalytics(e)}catch{}}))}stop(){this.securityFeaturesSubscription&&(this.securityFeaturesSubscription.unsubscribe(),this.securityFeaturesSubscription=void 0)}static async recordAuthTypeAnalytics(e){localStorage.setItem(analytics_service_AnalyticsService.AuthTypeInfoStorageKey,JSON.stringify(await e.post("/internal/security/analytics/_record_auth_type",{body:localStorage.getItem(analytics_service_AnalyticsService.AuthTypeInfoStorageKey)})))}}s()(analytics_service_AnalyticsService,"AuthTypeInfoStorageKey","kibana.security.userAuthType");const x=Object.freeze({isEnabled:!1,accessURLParameters:null});class anonymous_access_service_AnonymousAccessService{constructor(){s()(this,"internalService",void 0)}setup({share:e}){e.setAnonymousAccessServiceProvider((()=>this.internalService))}start({http:e}){this.internalService={getCapabilities:()=>e.get("/internal/security/anonymous_access/capabilities"),getState:()=>e.anonymousPaths.isAnonymous(window.location.pathname)?Promise.resolve(x):e.get("/internal/security/anonymous_access/state").catch((()=>x))}}}const S=Object.freeze({id:"security_access_agreement",create({application:e,getStartServices:t}){e.register({id:this.id,title:r.i18n.translate("xpack.security.accessAgreementAppTitle",{defaultMessage:"Access Agreement"}),chromeless:!0,appRoute:"/security/access_agreement",async mount({element:e,theme$:i}){const[[s],{renderAccessAgreementPage:r}]=await Promise.all([t(),Promise.all([n.e(0),n.e(1),n.e(2),n.e(10)]).then(n.bind(null,275))]);return r(s.i18n,{element:e,theme$:i},{http:s.http,notifications:s.notifications,fatalErrors:s.fatalErrors})}})}});var _=n(10);const O=Object.freeze({id:"security_capture_url",create({application:e,fatalErrors:t,http:i}){i.anonymousPaths.register("/internal/security/capture-url"),e.register({id:this.id,title:"Capture URL",chromeless:!0,appRoute:"/internal/security/capture-url",async mount(){try{const{parseNext:e}=await n.e(0).then(n.bind(null,88)),t=new URL(e(window.location.href,i.basePath.serverBasePath),window.location.origin);t.searchParams.append(_.c,window.location.hash),window.location.replace(t.toString())}catch(e){t.add(new Error(`Cannot parse current URL: ${e&&e.message}.`))}return()=>{}}})}}),w=Object.freeze({id:"security_logged_out",create({application:e,http:t,getStartServices:i}){t.anonymousPaths.register("/security/logged_out"),e.register({id:this.id,title:r.i18n.translate("xpack.security.loggedOutAppTitle",{defaultMessage:"Logged out"}),chromeless:!0,appRoute:"/security/logged_out",async mount({element:e,theme$:t}){const[[s],{renderLoggedOutPage:r}]=await Promise.all([i(),Promise.all([n.e(0),n.e(1),n.e(15)]).then(n.bind(null,276))]);return r(s.i18n,{element:e,theme$:t},{basePath:s.http.basePath})}})}}),A=Object.freeze({id:"security_login",create({application:e,http:t,getStartServices:i,config:s}){t.anonymousPaths.register("/login"),e.register({id:this.id,title:r.i18n.translate("xpack.security.loginAppTitle",{defaultMessage:"Login"}),chromeless:!0,appRoute:"/login",async mount({element:e,theme$:t}){const[[r],{renderLoginPage:a}]=await Promise.all([i(),Promise.all([n.e(2),n.e(7)]).then(n.bind(null,287))]);return a(r.i18n,{element:e,theme$:t},{http:r.http,notifications:r.notifications,fatalErrors:r.fatalErrors,loginAssistanceMessage:s.loginAssistanceMessage,sameSiteCookies:s.sameSiteCookies})}})}}),P=Object.freeze({id:"security_logout",create({application:e,http:t}){t.anonymousPaths.register("/logout"),e.register({id:this.id,title:r.i18n.translate("xpack.security.logoutAppTitle",{defaultMessage:"Logout"}),chromeless:!0,appRoute:"/logout",mount:async()=>(window.sessionStorage.clear(),window.localStorage.removeItem(analytics_service_AnalyticsService.AuthTypeInfoStorageKey),window.location.href=t.basePath.prepend(`/api/security/logout${window.location.search}`),()=>{})})}}),C=Object.freeze({id:"security_overwritten_session",create({application:e,authc:t,getStartServices:i}){e.register({id:this.id,title:r.i18n.translate("xpack.security.overwrittenSessionAppTitle",{defaultMessage:"Overwritten Session"}),chromeless:!0,appRoute:"/security/overwritten_session",async mount({element:e,theme$:s}){const[[r],{renderOverwrittenSessionPage:a}]=await Promise.all([i(),Promise.all([n.e(0),n.e(1),n.e(16)]).then(n.bind(null,277))]);return a(r.i18n,{element:e,theme$:s},{authc:t,basePath:r.http.basePath})}})}});class authentication_service_AuthenticationService{setup({application:e,fatalErrors:t,config:n,getStartServices:i,http:s}){const r=async()=>await s.get("/internal/security/me",{asSystemRequest:!0});return S.create({application:e,getStartServices:i}),O.create({application:e,fatalErrors:t,http:s}),A.create({application:e,config:n,getStartServices:i,http:s}),P.create({application:e,http:s}),w.create({application:e,getStartServices:i,http:s}),C.create({application:e,authc:{getCurrentUser:r},getStartServices:i}),{getCurrentUser:r,areAPIKeysEnabled:async()=>(await s.get("/internal/security/api_key/_enabled")).apiKeysEnabled}}}var k=n(15);const I=Object.freeze({id:"api_keys",create({authc:e,getStartServices:t}){return{id:this.id,order:30,title:r.i18n.translate("xpack.security.management.apiKeysTitle",{defaultMessage:"API keys"}),async mount({element:i,theme$:s,setBreadcrumbs:a,history:o}){const[[c],{APIKeysGridPage:l},{APIKeysAPIClient:h}]=await Promise.all([t(),n.e(4).then(n.bind(null,285)),n.e(17).then(n.bind(null,107))]);return Object(u.render)(Object(v.jsx)(E,{services:c,theme$:s,history:o,authc:e,onChange:Object(g.c)(c.chrome,a)},Object(v.jsx)(g.a,{text:r.i18n.translate("xpack.security.management.apiKeysTitle",{defaultMessage:"API keys"}),href:"/"},Object(v.jsx)(l,{history:o,notifications:c.notifications,apiKeysAPIClient:new h(c.http)}))),i),()=>{Object(u.unmountComponentAtNode)(i)}}}}}),E=({services:e,theme$:t,history:n,authc:i,onChange:s,children:r})=>Object(v.jsx)(b.KibanaContextProvider,{services:e},Object(v.jsx)(k.a,{authc:i},Object(v.jsx)(p.I18nProvider,null,Object(v.jsx)(b.KibanaThemeProvider,{theme$:t},Object(v.jsx)(h.Router,{history:n},Object(v.jsx)(g.b,{onChange:s},r))))));var T=n(19);const M=Object.freeze({id:"role_mappings",create({getStartServices:e}){const t=r.i18n.translate("xpack.security.management.roleMappingsTitle",{defaultMessage:"Role Mappings"});return{id:this.id,order:40,title:t,async mount({element:i,theme$:s,setBreadcrumbs:a,history:o}){const[[c],{RoleMappingsGridPage:l},{EditRoleMappingPage:d},{RoleMappingsAPIClient:p},{RolesAPIClient:f}]=await Promise.all([e(),n.e(11).then(n.bind(null,288)),n.e(8).then(n.bind(null,284)),n.e(18).then(n.bind(null,278)),Promise.resolve().then(n.bind(null,31))]);c.chrome.docTitle.change(t);const m=new p(c.http),y=({action:e})=>{const{name:t}=Object(h.useParams)(),n=t?Object(T.a)(t):void 0,i="edit"===e&&t&&n?{text:n,href:`/edit/${encodeURIComponent(t)}`}:{text:r.i18n.translate("xpack.security.roleMappings.createBreadcrumb",{defaultMessage:"Create"})};return Object(v.jsx)(g.a,{text:i.text,href:i.href},Object(v.jsx)(d,{action:e,name:n,roleMappingsAPI:m,rolesAPIClient:new f(c.http),notifications:c.notifications,docLinks:c.docLinks,history:o}))};return Object(u.render)(Object(v.jsx)(b.KibanaContextProvider,{services:c},Object(v.jsx)(c.i18n.Context,null,Object(v.jsx)(b.KibanaThemeProvider,{theme$:s},Object(v.jsx)(h.Router,{history:o},Object(v.jsx)(g.b,{onChange:Object(g.c)(c.chrome,a)},Object(v.jsx)(g.a,{text:t,href:"/"},Object(v.jsx)(h.Route,{path:["/",""],exact:!0},Object(v.jsx)(l,{notifications:c.notifications,rolesAPIClient:new f(c.http),roleMappingsAPI:m,docLinks:c.docLinks,history:o,navigateToApp:c.application.navigateToApp})),Object(v.jsx)(h.Route,{path:"/edit/:name?"},Object(v.jsx)(y,{action:"edit"})),Object(v.jsx)(h.Route,{path:"/clone/:name"},Object(v.jsx)(y,{action:"clone"})))))))),i),()=>{Object(u.unmountComponentAtNode)(i)}}}}});var R=n(31),L=n(21);class management_service_ManagementService{constructor(){s()(this,"license",void 0),s()(this,"licenseFeaturesSubscription",void 0),s()(this,"securitySection",void 0)}setup({getStartServices:e,management:t,authc:n,license:i,fatalErrors:s}){this.license=i,this.securitySection=t.sections.section.security,this.securitySection.registerApp(L.usersManagementApp.create({authc:n,getStartServices:e})),this.securitySection.registerApp(R.rolesManagementApp.create({fatalErrors:s,license:i,getStartServices:e})),this.securitySection.registerApp(I.create({authc:n,getStartServices:e})),this.securitySection.registerApp(M.create({getStartServices:e}))}start({capabilities:e}){this.licenseFeaturesSubscription=this.license.features$.subscribe((async t=>{const n=this.securitySection,i=[[n.getApp(L.usersManagementApp.id),t.showLinks],[n.getApp(R.rolesManagementApp.id),t.showLinks],[n.getApp(I.id),t.showLinks],[n.getApp(M.id),t.showLinks&&t.showRoleMappingsManagement]];for(const[t,n]of i)!0===e.management.security[t.id]?t.enabled!==n&&(n?t.enable():t.disable()):t.disable()}))}stop(){this.licenseFeaturesSubscription&&(this.licenseFeaturesSubscription.unsubscribe(),this.licenseFeaturesSubscription=void 0)}}var $=n(25),U=n(24),F=n(34),N=n(2),D=n(17),B=n.n(D),z=n(30),K=n(20);const V=({editProfileUrl:e,logoutUrl:t,userMenuLinks$:n})=>{const i=B()(n,[]),[s,a]=Object(o.useState)(!1),c=Object(f.e)("avatar"),u=Object(f.c)(),l=u.value?Object(K.h)(u.value):"",h=Object(v.jsx)(N.EuiHeaderSectionItemButton,{"aria-controls":"headerUserMenu","aria-expanded":s,"aria-haspopup":"true","aria-label":r.i18n.translate("xpack.security.navControlComponent.accountMenuAriaLabel",{defaultMessage:"Account menu"}),onClick:()=>a((e=>!!u.value&&!e)),"data-test-subj":"userMenuButton",style:{lineHeight:"normal"}},c.value?Object(v.jsx)(z.a,{user:c.value.user,avatar:c.value.data.avatar,size:"s","data-test-subj":"userMenuAvatar"}):u.value&&c.error?Object(v.jsx)(z.a,{user:u.value,size:"s","data-test-subj":"userMenuAvatar"}):Object(v.jsx)(N.EuiLoadingSpinner,{size:"m"})),d=[];if(i.length){const e=i.sort((({order:e=1/0},{order:t=1/0})=>e-t)).map((({label:e,iconType:t,href:n})=>({name:e,icon:Object(v.jsx)(N.EuiIcon,{type:t,size:"m"}),href:n,"data-test-subj":`userMenuLink__${e}`})));d.push(...e)}const b=!!u.value&&Object(K.o)(u.value),g=i.some((({setAsProfile:e})=>!0===e));if(!b&&!g){const t={name:Object(v.jsx)(p.FormattedMessage,{id:"xpack.security.navControlComponent.editProfileLinkText",defaultMessage:"Edit profile"}),icon:Object(v.jsx)(N.EuiIcon,{type:"user",size:"m"}),href:e,onClick:()=>{a(!1)},"data-test-subj":"profileLink"};d.unshift(t)}return d.push({name:b?Object(v.jsx)(p.FormattedMessage,{id:"xpack.security.navControlComponent.loginLinkText",defaultMessage:"Log in"}):Object(v.jsx)(p.FormattedMessage,{id:"xpack.security.navControlComponent.logoutLinkText",defaultMessage:"Log out"}),icon:Object(v.jsx)(N.EuiIcon,{type:"exit",size:"m"}),href:t,"data-test-subj":"logoutLink"}),Object(v.jsx)(N.EuiPopover,{id:"headerUserMenu",ownFocus:!0,button:h,isOpen:s,anchorPosition:"downRight",repositionOnScroll:!0,closePopover:()=>a(!1),panelPaddingSize:"none",buffer:0},Object(v.jsx)("div",{"data-test-subj":"userMenu"},Object(v.jsx)(N.EuiContextMenu,{className:"chrNavControl__userMenu",initialPanelId:0,panels:[{id:0,title:l,items:d}]})))};class nav_control_service_SecurityNavControlService{constructor(){s()(this,"securityLicense",void 0),s()(this,"logoutUrl",void 0),s()(this,"securityApiClients",void 0),s()(this,"navControlRegistered",void 0),s()(this,"securityFeaturesSubscription",void 0),s()(this,"stop$",new j.ReplaySubject(1)),s()(this,"userMenuLinks$",new j.BehaviorSubject([]))}setup({securityLicense:e,logoutUrl:t,securityApiClients:n}){this.securityLicense=e,this.logoutUrl=t,this.securityApiClients=n}start({core:e,authc:t}){return this.securityFeaturesSubscription=this.securityLicense.features$.subscribe((({showLinks:n})=>{!e.http.anonymousPaths.isAnonymous(window.location.pathname)&&n&&!this.navControlRegistered&&this.registerSecurityNavControl(e,t)})),{getUserMenuLinks$:()=>this.userMenuLinks$.pipe(Object(a.map)(this.sortUserMenuLinks),Object(a.takeUntil)(this.stop$)),addUserMenuLinks:e=>{const t=this.userMenuLinks$.value,n=t.find((({setAsProfile:e})=>!0===e)),i=e.filter((({setAsProfile:e})=>!0===e)).length;if(n&&i>0)throw new Error(`Only one custom profile link can be set. A custom profile link named ${n.label} (${n.href}) already exists`);if(i>1)throw new Error(`Only one custom profile link can be passed at a time (found ${i})`);const s=[...t,...e];this.userMenuLinks$.next(s)}}}stop(){this.securityFeaturesSubscription&&(this.securityFeaturesSubscription.unsubscribe(),this.securityFeaturesSubscription=void 0),this.navControlRegistered=!1,this.stop$.next()}registerSecurityNavControl(e,t){const{theme$:n}=e.theme;e.chrome.navControls.registerRight({order:2e3,mount:i=>(l.a.render(Object(v.jsx)(H,{services:e,authc:t,theme$:n,securityApiClients:this.securityApiClients},Object(v.jsx)(V,{editProfileUrl:e.http.basePath.prepend("/security/account"),logoutUrl:this.logoutUrl,userMenuLinks$:this.userMenuLinks$})),i),()=>l.a.unmountComponentAtNode(i))}),this.navControlRegistered=!0}sortUserMenuLinks(e){return Object(U.sortBy)(e,"order")}}const H=({authc:e,services:t,theme$:n,securityApiClients:i,children:s})=>Object(v.jsx)(b.KibanaContextProvider,{services:t},Object(v.jsx)(f.a,{authc:e},Object(v.jsx)(f.b,i,Object(v.jsx)(p.I18nProvider,null,Object(v.jsx)(b.KibanaThemeProvider,{theme$:n},Object(v.jsx)(F.a,{coreStart:t},s)))))),W=r.i18n.translate("xpack.security.checkup.insecureClusterTitle",{defaultMessage:"Your data is not secure"}),G=(e,t)=>n=>(Object(u.render)(Object(v.jsx)((()=>{const[n,i]=Object(o.useState)(!1),s=`${e.links.security.elasticsearchEnableSecurity}?blade=kibanasecuritymessage`;return Object(v.jsx)(p.I18nProvider,null,Object(v.jsx)("div",{"data-test-subj":"insecureClusterAlertText"},Object(v.jsx)(N.EuiText,{size:"s"},Object(v.jsx)(p.FormattedMessage,{id:"xpack.security.checkup.insecureClusterMessage",defaultMessage:"Donâ€™t lose one bit. Enable our free security features."})),Object(v.jsx)(N.EuiSpacer,null),Object(v.jsx)(N.EuiCheckbox,{id:"persistDismissedAlertPreference",checked:n,onChange:e=>i(e.target.checked),label:r.i18n.translate("xpack.security.checkup.dontShowAgain",{defaultMessage:"Don't show again"})}),Object(v.jsx)(N.EuiSpacer,null),Object(v.jsx)(N.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(v.jsx)(N.EuiFlexItem,{grow:!1},Object(v.jsx)(N.EuiButton,{size:"s",color:"primary",fill:!0,href:s,target:"_blank","data-test-subj":"learnMoreButton"},r.i18n.translate("xpack.security.checkup.enableButtonText",{defaultMessage:"Enable security"}))),Object(v.jsx)(N.EuiFlexItem,{grow:!1},Object(v.jsx)(N.EuiButton,{size:"s",onClick:()=>t(n),"data-test-subj":"dismissAlertButton"},r.i18n.translate("xpack.security.checkup.dismissButtonText",{defaultMessage:"Dismiss"}))))))}),null),n),()=>Object(u.unmountComponentAtNode)(n)),q=Object.freeze({displayAlert:!1});class security_checkup_service_SecurityCheckupService{constructor(e,t){s()(this,"enabled",void 0),s()(this,"alertVisibility$",void 0),s()(this,"storage",void 0),s()(this,"alertToast",void 0),s()(this,"storageKey",void 0),this.storage=t,this.enabled=e.showInsecureClusterWarning,this.alertVisibility$=new j.BehaviorSubject(this.enabled)}setup({http:e}){const t=e.basePath.serverBasePath;this.storageKey=`insecureClusterWarningVisibility${t}`,this.enabled=this.enabled&&this.getPersistedVisibilityPreference(),this.alertVisibility$.next(this.enabled)}start(e){this.enabled&&this.initializeAlert(e)}initializeAlert({http:e,notifications:t,docLinks:n}){const i=Object(j.from)(this.getSecurityCheckupState(e));Object(j.combineLatest)([i,this.alertVisibility$]).pipe(Object(a.map)((([{displayAlert:e},t])=>e&&t)),Object(a.distinctUntilChanged)()).subscribe((e=>{e&&!this.alertToast?this.alertToast=t.toasts.addWarning({title:W,text:G(n,(e=>this.setAlertVisibility(!1,e))),iconType:"alert"},{toastLifeTimeMs:864e6}):!e&&this.alertToast&&(t.toasts.remove(this.alertToast),this.alertToast=void 0)}))}getSecurityCheckupState(e){return e.anonymousPaths.isAnonymous(window.location.pathname)?Promise.resolve(q):e.get("/internal/security/security_checkup/state").catch((()=>q))}setAlertVisibility(e,t){this.enabled&&(this.alertVisibility$.next(e),t&&this.setPersistedVisibilityPreference(e))}getPersistedVisibilityPreference(){var e;const t=null!==(e=this.storage.getItem(this.storageKey))&&void 0!==e?e:"{}";try{const{show:e=!0}=JSON.parse(t);return e}catch(e){return!0}}setPersistedVisibilityPreference(e){this.storage.setItem(this.storageKey,JSON.stringify({show:e}))}}class session_expired_SessionExpired{constructor(e,t,n){this.application=e,this.logoutUrl=t,this.tenant=n}logout(e){const t=(()=>{const{location:e}=window,t=encodeURIComponent(`${e.pathname}${e.search}${e.hash}`);return`&${_.h}=${t}`})(),n=(e=>{const t=`${this.tenant}/session_provider`,n=sessionStorage.getItem(t);return n?`&${_.d}=${encodeURIComponent(n)}`:""})();this.application.navigateToUrl(`${this.logoutUrl}?${_.e}=${e}${t}${n}`,{forceRedirect:!0,skipAppLeave:!0})}}let J;!function(e){e.SESSION_EXPIRED="SESSION_EXPIRED",e.AUTHENTICATION_ERROR="AUTHENTICATION_ERROR",e.LOGGED_OUT="LOGGED_OUT",e.UNAUTHENTICATED="UNAUTHENTICATED"}(J||(J={}));var Z=n(27),X=n.n(Z);const Y=({sessionState$:e,onExtend:t})=>{const n=B()(e),[{loading:i},s]=X()(t);if(!n||!n.expiresInMs)return null;const r=Object(v.jsx)(p.FormattedMessage,{id:"xpack.security.sessionExpirationToast.body",defaultMessage:"You will be logged out {timeout}.",values:{timeout:Object(v.jsx)(p.FormattedRelative,{value:Math.max(n.expiresInMs-_.l,0)+Date.now(),updateInterval:1e3})}});return n.canBeExtended?Object(v.jsx)(c.a.Fragment,null,r,Object(v.jsx)(N.EuiSpacer,{size:"m"}),Object(v.jsx)(N.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"s"},Object(v.jsx)(N.EuiFlexItem,{grow:!1},Object(v.jsx)(N.EuiButton,{size:"s",color:"warning",isLoading:i,onClick:s},Object(v.jsx)(p.FormattedMessage,{id:"xpack.security.sessionExpirationToast.extendButton",defaultMessage:"Stay logged in"}))))):r};class session_timeout_SessionTimeout{constructor(e,t,n,i){s()(this,"channel",void 0),s()(this,"isVisible","hidden"!==document.visibilityState),s()(this,"isFetchingSessionInfo",!1),s()(this,"consecutiveErrorCount",0),s()(this,"snoozedWarningState",void 0),s()(this,"sessionState$",new j.BehaviorSubject({lastExtensionTime:0,expiresInMs:null,canBeExtended:!1})),s()(this,"subscription",void 0),s()(this,"warningToast",void 0),s()(this,"stopActivityMonitor",void 0),s()(this,"stopVisibilityMonitor",void 0),s()(this,"removeHttpInterceptor",void 0),s()(this,"stopRefreshTimer",void 0),s()(this,"stopWarningTimer",void 0),s()(this,"stopLogoutTimer",void 0),s()(this,"handleChannelMessage",(e=>{this.isSessionState(e.data)&&this.sessionState$.next(e.data)})),s()(this,"isSessionState",(e=>"object"==typeof e&&Object.hasOwn(null!=e?e:{},"canBeExtended"))),s()(this,"handleHttpRequest",(e=>{if(-1===e.path.indexOf("://")&&!e.path.startsWith("//"))return e.asSystemRequest?void 0:{...e,asSystemRequest:!this.isVisible}})),s()(this,"handleUserActivity",(()=>{this.shouldExtend()&&this.fetchSessionInfo(!0)})),s()(this,"handleVisibilityChange",(e=>{this.isVisible=e,e&&this.handleUserActivity()})),s()(this,"resetTimers",(({lastExtensionTime:e,expiresInMs:t})=>{var n,i,s;if(this.stopRefreshTimer=null===(n=this.stopRefreshTimer)||void 0===n?void 0:n.call(this),this.stopWarningTimer=null===(i=this.stopWarningTimer)||void 0===i?void 0:i.call(this),this.stopLogoutTimer=null===(s=this.stopLogoutTimer)||void 0===s?void 0:s.call(this),null!==t){const n=Math.max(t-_.l,0),i=Math.max(n-_.j,this.snoozedWarningState?this.snoozedWarningState.lastExtensionTime+this.snoozedWarningState.expiresInMs-_.l-e:0,0),s=i-_.i;this.stopLogoutTimer=Q((()=>this.sessionExpired.logout(J.SESSION_EXPIRED)),n),i>0&&this.hideWarning(),i<n&&(this.stopWarningTimer=Q(this.showWarning,i)),s>0&&s<n&&(this.stopRefreshTimer=Q(this.fetchSessionInfo,s))}})),s()(this,"toggleEventHandlers",(({expiresInMs:e,canBeExtended:t})=>{var n,i,s;null!==e?(t&&!this.stopActivityMonitor&&(this.stopActivityMonitor=function(e){const t=["mousemove","mousedown","wheel","touchstart","keydown"];for(const n of t)window.addEventListener(n,e);return()=>{for(const n of t)window.removeEventListener(n,e)}}(this.handleUserActivity)),this.removeHttpInterceptor||(this.removeHttpInterceptor=this.http.intercept({request:this.handleHttpRequest})),this.stopVisibilityMonitor||(this.stopVisibilityMonitor=function(e){const t=()=>e("hidden"!==document.visibilityState);return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}}(this.handleVisibilityChange))):(this.removeHttpInterceptor=null===(n=this.removeHttpInterceptor)||void 0===n?void 0:n.call(this),this.stopActivityMonitor=null===(i=this.stopActivityMonitor)||void 0===i?void 0:i.call(this),this.stopVisibilityMonitor=null===(s=this.stopVisibilityMonitor)||void 0===s?void 0:s.call(this))})),s()(this,"fetchSessionInfo",(async(e=!1)=>{this.isFetchingSessionInfo=!0;try{const t=await this.http.fetch(_.m,{method:e?"POST":"GET",asSystemRequest:!e});if(this.consecutiveErrorCount=0,t){const{expiresInMs:e,canBeExtended:n}=t,i={lastExtensionTime:Date.now(),expiresInMs:e,canBeExtended:n};return this.sessionState$.next(i),this.channel&&this.channel.postMessage(i),i}}catch(e){this.consecutiveErrorCount++}finally{this.isFetchingSessionInfo=!1}})),s()(this,"showWarning",(()=>{if(!this.warningToast){const e=async()=>{const{canBeExtended:e}=this.sessionState$.getValue();e&&await this.fetchSessionInfo(!0)},t=()=>(this.hideWarning(!0),e()),n=((e,t,n)=>({color:"warning",iconType:"clock",title:r.i18n.translate("xpack.security.sessionExpirationToast.title",{defaultMessage:"Session timeout"}),text:Object(b.toMountPoint)(Object(v.jsx)(Y,{sessionState$:e,onExtend:t})),onClose:n,toastLifeTimeMs:2147483647}))(this.sessionState$,e,t);this.warningToast=this.notifications.toasts.add(n)}})),s()(this,"hideWarning",((e=!1)=>{this.warningToast&&(this.notifications.toasts.remove(this.warningToast),this.warningToast=void 0,e&&(this.snoozedWarningState=this.sessionState$.getValue()))})),this.notifications=e,this.sessionExpired=t,this.http=n,this.tenant=i}async start(){if(!this.http.anonymousPaths.isAnonymous(window.location.pathname)){this.subscription=this.sessionState$.pipe(Object(a.skip)(1),Object(a.throttleTime)(1e3),Object(a.tap)(this.toggleEventHandlers)).subscribe(this.resetTimers);try{this.channel=new BroadcastChannel(`${this.tenant}/session_timeout`),this.channel.onmessage=e=>this.handleChannelMessage(e)}catch(e){console.warn("Failed to load broadcast channel. Session management will not be kept in sync when multiple tabs are loaded.",e)}return this.fetchSessionInfo()}}stop(){var e,t;const n={lastExtensionTime:0,expiresInMs:null,canBeExtended:!1};this.toggleEventHandlers(n),this.resetTimers(n),null===(e=this.subscription)||void 0===e||e.unsubscribe(),null===(t=this.channel)||void 0===t||t.close()}shouldExtend(){const{lastExtensionTime:e}=this.sessionState$.getValue();return!this.isFetchingSessionInfo&&!this.warningToast&&Date.now()>e+_.k*Math.exp(this.consecutiveErrorCount)}}function Q(e,t,n){var i;const s=2147483647;let r;return(n=null!==(i=n)&&void 0!==i?i:e=>r=e)(t>s?window.setTimeout((()=>Q(e,t-s,n)),s):window.setTimeout(e,t)),()=>clearTimeout(r)}class unauthorized_response_http_interceptor_UnauthorizedResponseHttpInterceptor{constructor(e,t){this.sessionExpired=e,this.anonymousPaths=t}responseError(e,t){if(this.anonymousPaths.isAnonymous(window.location.pathname))return;if("omit"===e.request.credentials)return;const{response:n}=e;n&&401===n.status&&(this.sessionExpired.logout(J.AUTHENTICATION_ERROR),t.halt())}}var ee=n(12),te=n.n(ee);class suspense_error_boundary_SuspenseErrorBoundary extends o.Component{constructor(...e){super(...e),s()(this,"state",{error:null})}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e){const{notifications:t}=this.props;if(t){const n=r.i18n.translate("xpack.security.uiApi.errorBoundaryToastTitle",{defaultMessage:"Failed to load Kibana asset"}),i=r.i18n.translate("xpack.security.uiApi.errorBoundaryToastMessage",{defaultMessage:"Reload page to continue."});t.toasts.addError(e,{title:n,toastMessage:i})}}render(){const{children:e,notifications:t}=this.props,{error:n}=this.state;return!t||n?null:Object(v.jsx)(o.Suspense,{fallback:Object(v.jsx)(N.EuiLoadingSpinner,null)},e)}}const ne=({fn:e,core:t,props:n})=>{const{notifications:i}=t,s=Object(o.useMemo)((()=>Object(o.lazy)((()=>e().then((e=>({default:e})))))),[e]);return i?Object(v.jsx)(suspense_error_boundary_SuspenseErrorBoundary,{notifications:i},Object(v.jsx)(s,n)):null},ie=async()=>{const{PersonalInfo:e}=await n.e(21).then(n.bind(null,282));return t=>Object(v.jsx)(e,t)},se=({core:e})=>{function t(t){return n=>Object(v.jsx)(ne,{fn:t,core:e,props:n})}return{getPersonalInfo:t(ie),getChangePassword:t((()=>(async e=>{const{ChangePassword:t}=await n.e(14).then(n.bind(null,281));return n=>Object(v.jsx)(t,te()({notifications:e.notifications,userAPIClient:new L.UserAPIClient(e.http)},n))})(e)))}},re=({core:e})=>({components:se({core:e})});class plugin_SecurityPlugin{constructor(e){s()(this,"config",void 0),s()(this,"sessionTimeout",void 0),s()(this,"authenticationService",new authentication_service_AuthenticationService),s()(this,"navControlService",new nav_control_service_SecurityNavControlService),s()(this,"securityLicenseService",new license_service_SecurityLicenseService),s()(this,"managementService",new management_service_ManagementService),s()(this,"securityCheckupService",void 0),s()(this,"anonymousAccessService",new anonymous_access_service_AnonymousAccessService),s()(this,"analyticsService",new analytics_service_AnalyticsService),s()(this,"authc",void 0),s()(this,"securityApiClients",void 0),this.initializerContext=e,this.config=this.initializerContext.config.get(),this.securityCheckupService=new security_checkup_service_SecurityCheckupService(this.config,localStorage)}setup(e,{home:t,licensing:n,management:i,share:s}){const{license:a}=this.securityLicenseService.setup({license$:n.license$});return this.securityCheckupService.setup({http:e.http}),this.authc=this.authenticationService.setup({application:e.application,fatalErrors:e.fatalErrors,config:this.config,getStartServices:e.getStartServices,http:e.http}),this.securityApiClients={userProfiles:new user_profile_api_client_UserProfileAPIClient(e.http),users:new $.UserAPIClient(e.http)},this.navControlService.setup({securityLicense:a,logoutUrl:ae(e.http),securityApiClients:this.securityApiClients}),this.analyticsService.setup({securityLicense:a}),m.create({authc:this.authc,application:e.application,getStartServices:e.getStartServices,securityApiClients:this.securityApiClients}),i&&this.managementService.setup({license:a,management:i,authc:this.authc,fatalErrors:e.fatalErrors,getStartServices:e.getStartServices}),i&&t&&t.featureCatalogue.register({id:"security",title:r.i18n.translate("xpack.security.registerFeature.securitySettingsTitle",{defaultMessage:"Manage permissions"}),description:r.i18n.translate("xpack.security.registerFeature.securitySettingsDescription",{defaultMessage:"Control who has access and what tasks they can perform."}),icon:"securityApp",path:"/app/management/security/roles",showOnHomePage:!0,category:"admin",order:600}),s&&this.anonymousAccessService.setup({share:s}),{authc:this.authc,license:a}}start(e,{management:t,share:n}){const{application:i,http:s,notifications:r,docLinks:a}=e,{anonymousPaths:o}=s,c=ae(s),u=s.basePath.serverBasePath,l=new session_expired_SessionExpired(i,c,u);return s.intercept(new unauthorized_response_http_interceptor_UnauthorizedResponseHttpInterceptor(l,o)),this.sessionTimeout=new session_timeout_SessionTimeout(r,l,s,u),this.sessionTimeout.start(),this.securityCheckupService.start({http:s,notifications:r,docLinks:a}),t&&this.managementService.start({capabilities:i.capabilities}),n&&this.anonymousAccessService.start({http:s}),this.analyticsService.start({http:e.http}),{uiApi:re({core:e}),navControlService:this.navControlService.start({core:e,authc:this.authc}),authc:this.authc,userProfiles:{getCurrent:this.securityApiClients.userProfiles.getCurrent.bind(this.securityApiClients.userProfiles),bulkGet:this.securityApiClients.userProfiles.bulkGet.bind(this.securityApiClients.userProfiles),suggest:this.securityApiClients.userProfiles.suggest.bind(this.securityApiClients.userProfiles)}}}stop(){var e;null===(e=this.sessionTimeout)||void 0===e||e.stop(),this.navControlService.stop(),this.securityLicenseService.stop(),this.managementService.stop(),this.analyticsService.stop()}}function ae(e){return`${e.basePath.serverBasePath}/logout`}const oe=e=>new plugin_SecurityPlugin(e)},function(e,t){e.exports=__kbnSharedDeps__.Classnames},function(e,t){e.exports=__kbnSharedDeps__.KbnUiTheme},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/features/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/spaces/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t){e.exports=__kbnSharedDeps__.MomentTimezone},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/esUiShared/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t){e.exports=__kbnSharedDeps__.KbnMonaco},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/spaces/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t){e.exports=__kbnSharedDeps__.KbnStd}]);