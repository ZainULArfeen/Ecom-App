/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.securitySolution_bundle_jsonpfunction=window.securitySolution_bundle_jsonpfunction||[]).push([[22],{1220:function(e,t,i){"use strict";i.r(t),i.d(t,"EqlTabContentComponent",(function(){return de})),i.d(t,"default",(function(){return ce}));var a=i(17),n=i(3),l=i(4),r=i.n(l),o=i(24),s=i.n(o),d=i(47),c=i(92),u=i.n(c),m=i(323),p=i(8),g=i(91),y=i(899),b=i(80),f=i(878),E=i(901),h=i(241),v=i(871),O=i(15),q=i(349),j=i(673),w=i(433),k=i(600),P=i(78),C=i(13),S=i(94),F=i(207),x=i(672),I=i(902),D=i(96),T=i(84),B=i(418),N=i(5),Q=i(76),L=i(679),V=i(529),M=i(210);const $=i(6).i18n.translate("xpack.securitySolution.timeline.EqlQueryBarLabel",{defaultMessage:"EQL query"});var _=i(14),z=i(103);const H={index:[],eqlQueryBar:{query:{query:"",language:"eql"},filters:[],saved_id:null}},R={index:{fieldsToValidateOnChange:["index","eqlQueryBar"],validations:[]},eqlQueryBar:{validations:[{validator:Object(V.a)(V.b,300)}]}},K=s()(M.e).withConfig({displayName:"HiddenUseField",componentId:"sc-fj97qw-0"})(["display:none;"]),G=Object(l.memo)((({timelineId:e})=>{var t;const i=Object(d.useDispatch)(),a=Object(l.useRef)(!0),[n,o]=Object(l.useState)(!1),[s,c]=Object(l.useState)(!1),u=Object(l.useMemo)((()=>Object(_.createSelector)(z.selectTimeline,(e=>{var t;return null!==(t=null==e?void 0:e.eqlOptions)&&void 0!==t?t:{eventCategoryField:[{label:"event.category"}],tiebreakerField:[{label:""}],timestampField:[{label:"@timestamp"}],size:100,query:""}}))),[]),m=Object(Q.a)((t=>u(t,e))),{loading:p,indexPattern:y,selectedPatterns:b}=Object(F.d)(C.SourcererScopeName.timeline),f={...H,index:b.sort(),eqlQueryBar:{...H.eqlQueryBar,query:{query:null!==(t=m.query)&&void 0!==t?t:"",language:"eql"}}},{form:E}=Object(M.k)({defaultValue:f,options:{stripEmptyFields:!1},schema:R}),{getFields:h}=E,v=Object(l.useCallback)(((t,a)=>i(g.a.updateEqlOptions({id:e,field:t,value:a}))),[i,e]),[{eqlQueryBar:O}]=Object(M.m)({form:E,watch:["eqlQueryBar"]}),q=Object(l.useMemo)((()=>Object(N.isEmpty)(y.fields)?{keywordFields:[],dateFields:[],nonDateFields:[]}:{keywordFields:y.fields.filter((e=>{var t;return null===(t=e.esTypes)||void 0===t?void 0:t.includes("keyword")})).map((e=>({label:e.name}))),dateFields:y.fields.filter((e=>"date"===e.type)).map((e=>({label:e.name}))),nonDateFields:y.fields.filter((e=>"date"!==e.type)).map((e=>({label:e.name})))}),[y]);return Object(l.useEffect)((()=>{const{index:e}=h(),t=b.sort(),i=e.value.sort();Object(N.isEqual)(i,t)||e.setValue(t)}),[h,b]),Object(l.useEffect)((()=>{const{eqlQueryBar:e}=h();var t;return a.current&&(a.current=!1,c(!0),e.setValue({...H.eqlQueryBar,query:{query:null!==(t=m.query)&&void 0!==t?t:"",language:"eql"}})),()=>{a.current=!0}}),[h,m.query]),Object(l.useEffect)((()=>{null==O||Object(N.isEmpty)(O.query.query)||!n||s||(i(g.a.updateEqlOptions({id:e,field:"query",value:`${O.query.query}`})),o(!1),c(!1))}),[i,O,n,s,e]),r.a.createElement(M.c,{form:E,"data-test-subj":"EqlQueryBarTimeline"},r.a.createElement(K,{key:"Index",path:"index"}),r.a.createElement(M.e,{key:"EqlQueryBar",path:"eqlQueryBar",component:L.a,componentProps:{optionsData:q,optionsSelected:m,onOptionsChange:v,onValidityChange:o,onValiditingChange:c,idAria:"timelineEqlQueryBar",isDisabled:p,isLoading:p,indexPattern:y,dataTestSubj:"timelineEqlQueryBar"},config:{...R.eqlQueryBar,label:$}}))}));var A=i(873),U=i(423),W=i(876),J=i(79);const X=s.a.div.withConfig({displayName:"TimelineHeaderContainer",componentId:"sc-1f3fsnr-0"})(["margin-top:6px;width:100%;"]);X.displayName="TimelineHeaderContainer";const Y=s()(a.EuiFlyoutHeader).withConfig({displayName:"StyledEuiFlyoutHeader",componentId:"sc-1f3fsnr-1"})(["align-items:stretch;box-shadow:none;display:flex;flex-direction:column;padding:0;&.euiFlyoutHeader{","}"],(({theme:e})=>`padding: 0 ${e.eui.euiSizeS} ${e.eui.euiSizeS} ${e.eui.euiSizeS};`)),Z=s()(a.EuiFlyoutBody).withConfig({displayName:"StyledEuiFlyoutBody",componentId:"sc-1f3fsnr-2"})(["overflow-y:hidden;flex:1;.euiFlyoutBody__overflow{overflow:hidden;mask-image:none;}.euiFlyoutBody__overflowContent{padding:0;height:100%;display:flex;}"]),ee=s()(a.EuiFlyoutFooter).withConfig({displayName:"StyledEuiFlyoutFooter",componentId:"sc-1f3fsnr-3"})(["background:none;padding:0;&.euiFlyoutFooter{","}"],(({theme:e})=>`padding: ${e.eui.euiSizeS} 0 0 0;`)),te=s()(a.EuiFlexGroup).withConfig({displayName:"FullWidthFlexGroup",componentId:"sc-1f3fsnr-4"})(["margin:0;width:100%;overflow:hidden;"]),ie=s()(a.EuiFlexItem).withConfig({displayName:"ScrollableFlexItem",componentId:"sc-1f3fsnr-5"})(["overflow:hidden;"]),ae=s()(a.EuiFlexItem).withConfig({displayName:"DatePicker",componentId:"sc-1f3fsnr-6"})([".euiSuperDatePicker__flexWrapper{max-width:none;width:auto;}"]);ae.displayName="DatePicker";const ne=s.a.div.withConfig({displayName:"VerticalRule",componentId:"sc-1f3fsnr-7"})(["width:2px;height:100%;background:",";"],(({theme:e})=>e.eui.euiColorLightShade));ne.displayName="VerticalRule";const le=s()(a.EuiBadge).withConfig({displayName:"EventsCountBadge",componentId:"sc-1f3fsnr-8"})(["margin-left:",";"],(({theme:e})=>e.eui.euiSizeS)),re=[],oe=[],se=[],de=({activeTab:e,columns:t,end:i,eqlOptions:o,expandedDetail:s,timelineId:c,isLive:u,itemsPerPage:P,itemsPerPageOptions:S,onEventClosed:N,renderCellValue:Q,rowRenderers:L,showExpandedDetails:V,start:M,timerangeKind:$})=>{var _;const z=Object(d.useDispatch)(),{query:H="",...R}=o,{portalNode:K}=Object(x.c)(),{setTimelineFullScreen:de,timelineFullScreen:ce}=Object(D.c)(),{browserFields:ue,dataViewId:me,loading:pe,runtimeMappings:ge,selectedPatterns:ye}=Object(F.d)(C.SourcererScopeName.timeline),be=Object(J.b)().isEnterprise()?6:5,fe=Object(n.isEmpty)(H);Object(l.useEffect)((()=>{z(g.a.initializeTGridSettings({id:c}))}),[z,c]);const[Ee,{events:he,inspect:ve,totalCount:Oe,pageInfo:qe,loadPage:je,updatedAt:we,refetch:ke}]=Object(y.a)({dataViewId:me,endDate:i,eqlOptions:R,fields:[...(Object(n.isEmpty)(t)?b.b:t).map((e=>e.id)),...q.h],filterQuery:null!=H?H:"",id:c,indexNames:ye,language:"eql",limit:P,runtimeMappings:ge,skip:!!(null==pe||pe||Object(n.isEmpty)(M)||Object(n.isEmpty)(i)||fe),startDate:M,timerangeKind:$}),Pe=Object(l.useCallback)((()=>{var e;N({tabType:O.l.eql,timelineId:c}),null!==(e=s[O.l.eql])&&void 0!==e&&e.panelView&&c===O.i.active&&V&&T.a.toggleExpandedDetail({})}),[N,c,s,V]);Object(l.useEffect)((()=>{z(g.a.updateIsLoading({id:c,isLoading:Ee||pe}))}),[pe,c,Ee,z]);const Ce=Object(l.useMemo)((()=>Object(U.a)(be).map((e=>({...e,headerCellRender:A.a})))),[be]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{node:K},Oe>=0?r.a.createElement(le,null,Oe):null),r.a.createElement(v.a,{id:`${c}-${O.l.eql}`,inputId:p.a.timeline,inspect:ve,loading:Ee,refetch:ke}),r.a.createElement(te,null,r.a.createElement(ie,{grow:2},r.a.createElement(Y,{"data-test-subj":`${e}-tab-flyout-header`,hasBorder:!1},r.a.createElement(a.EuiFlexGroup,{alignItems:"center",gutterSize:"s","data-test-subj":"timeline-date-picker-container"},ce&&null!=de&&r.a.createElement(j.b,{fullScreen:ce,setFullScreen:de}),r.a.createElement(ae,{grow:10},r.a.createElement(w.a,{id:p.a.timeline,timelineId:c})),r.a.createElement(a.EuiFlexItem,{grow:!1},r.a.createElement(I.a,null)),r.a.createElement(a.EuiFlexItem,{grow:1},e===O.l.eql&&r.a.createElement(W.a,{scope:C.SourcererScopeName.timeline}))),r.a.createElement(X,{"data-test-subj":"timelineHeader"},r.a.createElement(G,{timelineId:c}))),r.a.createElement(k.a,null,r.a.createElement(Z,{"data-test-subj":`${O.l.eql}-tab-flyout-body`,className:"timeline-flyout-body"},r.a.createElement(f.a,{activePage:qe.activePage,browserFields:ue,data:fe?re:he,id:c,refetch:ke,renderCellValue:Q,rowRenderers:L,sort:oe,tabType:O.l.eql,totalPages:Object(h.h)({itemsCount:Oe,itemsPerPage:P}),leadingControlColumns:Ce,trailingControlColumns:se})),r.a.createElement(ee,{"data-test-subj":`${O.l.eql}-tab-flyout-footer`,className:"timeline-flyout-footer"},!fe&&r.a.createElement(E.a,{activePage:null!==(_=null==qe?void 0:qe.activePage)&&void 0!==_?_:0,"data-test-subj":"timeline-footer",updatedAt:we,height:E.b,id:c,isLive:u,isLoading:Ee||pe,itemsCount:fe?0:he.length,itemsPerPage:P,itemsPerPageOptions:S,onChangePage:je,totalCount:fe?0:Oe})))),V&&r.a.createElement(r.a.Fragment,null,r.a.createElement(ne,null),r.a.createElement(ie,{grow:1},r.a.createElement(B.a,{browserFields:ue,runtimeMappings:ge,tabType:O.l.eql,timelineId:c,handleOnPanelClosed:Pe})))))},ce=Object(d.connect)((()=>{const e=g.b.getTimelineByIdSelector(),t=P.f.getTimelineSelector();return(i,{timelineId:a})=>{var n,l;const r=null!==(n=e(i,a))&&void 0!==n?n:S.a,o=t(i),{activeTab:s,columns:d,eqlOptions:c,expandedDetail:u,itemsPerPage:m,itemsPerPageOptions:p}=r;return{activeTab:s,columns:d,eqlOptions:c,end:o.timerange.to,expandedDetail:u,timelineId:a,isLive:"interval"===o.policy.kind,itemsPerPage:m,itemsPerPageOptions:p,showExpandedDetails:!!u[O.l.eql]&&!(null===(l=u[O.l.eql])||void 0===l||!l.panelView),start:o.timerange.from,timerangeKind:o.timerange.kind}}}),(e=>({onEventClosed:t=>{e(g.a.toggleDetailPanel(t))}})))(r.a.memo(de,((e,t)=>e.activeTab===t.activeTab&&((e,t)=>e.end===t.end&&e.start===t.start&&e.timerangeKind===t.timerangeKind)(e,t)&&u()(e.eqlOptions,t.eqlOptions)&&e.isLive===t.isLive&&e.itemsPerPage===t.itemsPerPage&&e.onEventClosed===t.onEventClosed&&e.showExpandedDetails===t.showExpandedDetails&&e.timelineId===t.timelineId&&u()(e.columns,t.columns)&&u()(e.itemsPerPageOptions,t.itemsPerPageOptions))))},871:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var a=i(4),n=i.n(a),l=i(47),r=i(82);const o=({id:e,inputId:t,inspect:i,loading:n,refetch:o,skip:s})=>{const d=Object(l.useDispatch)();return Object(a.useEffect)((()=>{s||d(r.b.setQuery({id:e,inputId:t,inspect:i,loading:n,refetch:o}))}),[d,e,t,n,o,i,s]),null},s=n.a.memo(o)},902:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var a=i(17),n=i(4),l=i.n(n),r=i(47),o=i(8),s=i(29),d=i(76),c=i(6);const u=c.i18n.translate("xpack.securitySolution.timeline.properties.lockDatePickerTooltip",{defaultMessage:"Disable syncing of date/time range between the currently viewed page and your timeline"}),m=c.i18n.translate("xpack.securitySolution.timeline.properties.unlockDatePickerTooltip",{defaultMessage:"Enable syncing of date/time range between the currently viewed page and your timeline"}),p=c.i18n.translate("xpack.securitySolution.timeline.properties.lockDatePickerDescription",{defaultMessage:"Lock global date picker to timeline date picker"}),g=c.i18n.translate("xpack.securitySolution.timeline.properties.unlockDatePickerDescription",{defaultMessage:"Unlock global date picker from timeline date picker"}),y=()=>{const e=Object(r.useDispatch)(),t=Object(n.useMemo)((()=>s.d.globalSelector()),[]),i=Object(d.b)((e=>t(e).linkTo.includes(o.a.timeline))),c=Object(n.useCallback)((()=>e(s.b.toggleTimelineLinkTo())),[e]);return l.a.createElement(a.EuiToolTip,{"data-test-subj":"timeline-date-picker-lock-tooltip",position:"top",content:i?u:m},l.a.createElement(a.EuiButtonIcon,{"data-test-subj":`timeline-date-picker-${i?"lock":"unlock"}-button`,color:"primary",onClick:c,iconType:i?"lock":"lockOpen","aria-label":i?g:p}))};y.displayName="TimelineDatePickerLockComponent";const b=l.a.memo(y)}}]);